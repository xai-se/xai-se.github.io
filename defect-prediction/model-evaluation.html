
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>(Step 4) Model Evaluation &#8212; Explainable AI for Software Engineering</title>
    
  <link href="../_static/css/theme.css" rel="stylesheet" />
  <link href="../_static/css/index.c5995385ac14fb8791e8eb36b4908be2.css" rel="stylesheet" />

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/sphinx-book-theme.e8e5499552300ddf5d7adccae7cc3b70.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../_static/js/index.1c5a1a01449ed65a7b51.js">

    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/togglebutton.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/sphinx-book-theme.12a9622fbb08dcb3a2a40b2c02b83a57.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["\\(", "\\)"]], "displayMath": [["\\[", "\\]"]], "processRefs": false, "processEnvironments": false}})</script>
    <script async="async" src="https://unpkg.com/thebe@0.5.1/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <link rel="canonical" href="https://xai4se.github.io/defect-prediction/model-evaluation.html" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="(Step 5) Model Ranking" href="model-ranking.html" />
    <link rel="prev" title="(Step 3) Model Construction" href="model-construction.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
      <img src="../_static/logo.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">Explainable AI for Software Engineering</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../index.html">
   Explainable AI for Software Engineering
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Hands-on Exercise
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../tutorials/pyexplainer-live-demo.html">
   ASE2021 PyExplainer Live-Demo
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../tutorials/hands-on-exercise.html">
   ASE2021 Hands-on Exercise
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Part1-What is Explainable AI?
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../xai/theory-of-explanations.html">
   A Theory of Explanations
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../xai/techniques-for-generating-explanations.html">
   Techniques for Generating Explanations
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../xai/model-specific-techniques.html">
   Model-specific Techniques for Generating Global Explanations
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../xai/model-agnostic-techniques.html">
   Model-agnostic Techniques for Generating Local Explanations
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Part2-Defect Prediction Models
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="software-quality-assurance.html">
   Software Quality Assurance
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="defect-prediction.html">
   Defect Prediction
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="data-collection.html">
   (Step 1) Data Collection
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="data-preprocessing.html">
   (Step 2) Data Preprocessing
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="model-construction.html">
   (Step 3) Model Construction
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   (Step 4) Model Evaluation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="model-ranking.html">
   (Step 5) Model Ranking
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Part3-Explainable AI for Software Engineering
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../xai4se/explainability-for-se.html">
   Explainability in Software Engineering
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../xai4se/a-case-study-of-defect-prediction.html">
   A Case Study of Defect Prediction
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../xai4se/defective-line-localization.html">
   (Example 1) Help developers localize which lines of code are the most risky
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../xai4se/local-defect-explanation.html">
   (Example 2) Help developers understand why a file is predicted as defective
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../xai4se/specific-sq-plan.html">
   (Example 3) Help managers develop software quality improvement plans
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../_sources/defect-prediction/model-evaluation.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/xai4se/xai4se.github.io"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/xai4se/xai4se.github.io/issues/new?title=Issue%20on%20page%20%2Fdefect-prediction/model-evaluation.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        <a class="edit-button" href="https://github.com/xai4se/xai4se.github.io/edit/master/docs/defect-prediction/model-evaluation.ipynb"><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Edit this page"><i class="fas fa-pencil-alt"></i>suggest edit</button></a>
    </div>
</div>

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/xai4se/xai4se.github.io/master?urlpath=lab/tree/docs/defect-prediction/model-evaluation.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="../_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        <a class="colab-button" href="https://colab.research.google.com/github/xai4se/xai4se.github.io/blob/master/docs/defect-prediction/model-evaluation.ipynb"><button type="button" class="btn btn-secondary topbarbtn"
                title="Launch Colab" data-toggle="tooltip" data-placement="left"><img class="colab-button-logo"
                    src="../_static/images/logo_colab.png"
                    alt="Interact on Colab">Colab</button></a>
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#always-select-evaluation-measures-according-to-the-goals-of-studies">
   Always select evaluation measures according to the goals of studies
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#predictive-accuracy-measures">
     Predictive Accuracy Measures
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#precision">
       Precision
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#recall">
       Recall
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#false-alarm-rate-far-or-false-positive-rate-fpr">
       False Alarm Rate (FAR) or False Positive Rate (FPR)
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#area-under-the-receiver-operator-characteristic-curve-auc">
       Area Under the receiver operator characteristic Curve (AUC)
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#matthews-correlation-coefficients-mcc">
       Matthews Correlation Coefficients (MCC)
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#effort-aware-measures">
     Effort-Aware Measures
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#initial-false-alarm-ifa">
       Initial False Alarm (IFA)
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#distance-to-heaven-d2h">
       Distance-to-Heaven (D2H)
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#top-k-loc-precision">
       Top k% LOC Precision
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#top-k-loc-recall">
       Top k% LOC Recall
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#suggested-readings">
   Suggested Readings
  </a>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="step-4-model-evaluation">
<h1>(Step 4) Model Evaluation<a class="headerlink" href="#step-4-model-evaluation" title="Permalink to this headline">¶</a></h1>
<!-- # - file: defect-prediction/model-validation.ipynb
# - file: defect-prediction/evaluation-measures.ipynb --><div class="section" id="always-select-evaluation-measures-according-to-the-goals-of-studies">
<h2>Always select evaluation measures according to the goals of studies<a class="headerlink" href="#always-select-evaluation-measures-according-to-the-goals-of-studies" title="Permalink to this headline">¶</a></h2>
<p>Different studies often have different goals of developing defect models.
For example, one study may want its defect models that yield the highest discriminatory power (i.e., optimise based on Area Under the receiver operator characteristic Curve (AUC) (AUC) <span id="id1">[<a class="reference internal" href="../References.html#id435">HM82</a>]</span>).
Another study may want its defect models to discover an actual defective module as early as possible (i.e., optimise based on initial false alarm <span id="id2">[<a class="reference internal" href="../References.html#id113">HXL17</a>]</span>).
Thus, several evaluation measures have been proposed to serve different goals of developing defect models.</p>
<!-- Examples are predictive accuracy measures (e.g., Area Under the ROC Curve (AUC) {cite}`Hanley1982-uo` and Matthews Correlation Coefficients (MCC) {cite}`matthews1975comparison`) and effort-aware measures (e.g., Distance-to-heaven {cite}`agrawal2018better` and Top k% LOC precision {cite}`huang2017supervised`). -->
<p>Below, we describe <em>5</em> predictive accuracy and <em>3</em> effort-aware measures in detail with interactive tutorials.
We also provide a code snippet for setting up the environment for interactive tutorials below, i.e., data preparation and model construction.</p>
<div class="cell tag_remove-output tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## Load Data and preparing datasets</span>

<span class="c1"># Import for Load Data</span>
<span class="kn">from</span> <span class="nn">os</span> <span class="kn">import</span> <span class="n">listdir</span>
<span class="kn">from</span> <span class="nn">os.path</span> <span class="kn">import</span> <span class="n">isfile</span><span class="p">,</span> <span class="n">join</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="c1"># Import for Split Data into Training and Testing Samples</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>

<span class="c1"># Import for Construct Defect Models (Classification)</span>
<span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">RandomForestClassifier</span> <span class="c1"># Random Forests</span>


<span class="n">train_dataset</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">((</span><span class="s2">&quot;../../datasets/lucene-2.9.0.csv&quot;</span><span class="p">),</span> <span class="n">index_col</span> <span class="o">=</span> <span class="s1">&#39;File&#39;</span><span class="p">)</span>
<span class="n">test_dataset</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">((</span><span class="s2">&quot;../../datasets/lucene-3.0.0.csv&quot;</span><span class="p">),</span> <span class="n">index_col</span> <span class="o">=</span> <span class="s1">&#39;File&#39;</span><span class="p">)</span>

<span class="n">outcome</span> <span class="o">=</span> <span class="s1">&#39;RealBug&#39;</span>
<span class="n">features</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;OWN_COMMIT&#39;</span><span class="p">,</span> <span class="s1">&#39;Added_lines&#39;</span><span class="p">,</span> <span class="s1">&#39;CountClassCoupled&#39;</span><span class="p">,</span> <span class="s1">&#39;AvgLine&#39;</span><span class="p">,</span> <span class="s1">&#39;RatioCommentToCode&#39;</span><span class="p">]</span>

<span class="c1"># process outcome to 0 and 1</span>
<span class="n">train_dataset</span><span class="p">[</span><span class="n">outcome</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Categorical</span><span class="p">(</span><span class="n">train_dataset</span><span class="p">[</span><span class="n">outcome</span><span class="p">])</span>
<span class="n">train_dataset</span><span class="p">[</span><span class="n">outcome</span><span class="p">]</span> <span class="o">=</span> <span class="n">train_dataset</span><span class="p">[</span><span class="n">outcome</span><span class="p">]</span><span class="o">.</span><span class="n">cat</span><span class="o">.</span><span class="n">codes</span>

<span class="n">test_dataset</span><span class="p">[</span><span class="n">outcome</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Categorical</span><span class="p">(</span><span class="n">test_dataset</span><span class="p">[</span><span class="n">outcome</span><span class="p">])</span>
<span class="n">test_dataset</span><span class="p">[</span><span class="n">outcome</span><span class="p">]</span> <span class="o">=</span> <span class="n">test_dataset</span><span class="p">[</span><span class="n">outcome</span><span class="p">]</span><span class="o">.</span><span class="n">cat</span><span class="o">.</span><span class="n">codes</span>

<span class="n">X_train</span> <span class="o">=</span> <span class="n">train_dataset</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">features</span><span class="p">]</span>
<span class="n">X_test</span> <span class="o">=</span> <span class="n">test_dataset</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">features</span><span class="p">]</span>

<span class="n">y_train</span> <span class="o">=</span> <span class="n">train_dataset</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">outcome</span><span class="p">]</span>
<span class="n">y_test</span> <span class="o">=</span> <span class="n">test_dataset</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">outcome</span><span class="p">]</span>


<span class="c1"># commits - # of commits that modify the file of interest</span>
<span class="c1"># Added lines - # of added lines of code</span>
<span class="c1"># Count class coupled - # of classes that interact or couple with the class of interest</span>
<span class="c1"># LOC - # of lines of code</span>
<span class="c1"># RatioCommentToCode - The ratio of lines of comments to lines of code</span>
<span class="n">features</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;nCommit&#39;</span><span class="p">,</span> <span class="s1">&#39;AddedLOC&#39;</span><span class="p">,</span> <span class="s1">&#39;nCoupledClass&#39;</span><span class="p">,</span> <span class="s1">&#39;LOC&#39;</span><span class="p">,</span> <span class="s1">&#39;CommentToCodeRatio&#39;</span><span class="p">]</span>

<span class="n">X_train</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">features</span>
<span class="n">X_test</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">features</span>
<span class="n">training_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">testing_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="c1">## Construct defect models</span>
<span class="c1"># Random Forests</span>
<span class="n">rf_model</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">1234</span><span class="p">,</span> <span class="n">n_jobs</span> <span class="o">=</span> <span class="mi">10</span><span class="p">)</span>
<span class="n">rf_model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>  
</pre></div>
</div>
</div>
</div>
<div class="section" id="predictive-accuracy-measures">
<h3>Predictive Accuracy Measures<a class="headerlink" href="#predictive-accuracy-measures" title="Permalink to this headline">¶</a></h3>
<div class="section" id="precision">
<h4>Precision<a class="headerlink" href="#precision" title="Permalink to this headline">¶</a></h4>
<p>Precision measures the proportion between the number of lines that are correctly identified as defective and the number of lines that are identified by the models.
Particularly, precision can be computed using a calculation of <span class="math notranslate nohighlight">\(\frac{TP}{(TP+FP)}\)</span>, where <span class="math notranslate nohighlight">\(TP\)</span> is the number of actual defective lines that are predicted as defective and <span class="math notranslate nohighlight">\(FP\)</span> is the number of clean lines that are predicted as defective.
A high precision value indicates that the models can correctly identify high number of defective lines.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">confusion_matrix</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">precision_score</span>

<span class="c1"># construct a confusion matrix</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Construct a confusion matrix:&#39;</span><span class="p">)</span>
<span class="n">tn</span><span class="p">,</span> <span class="n">fp</span><span class="p">,</span> <span class="n">fn</span><span class="p">,</span> <span class="n">tp</span> <span class="o">=</span> <span class="n">confusion_matrix</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span><span class="n">rf_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">))</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;(True Positive, False Positive) = (&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">tp</span><span class="p">)</span> <span class="o">+</span><span class="s1">&#39;,&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">fp</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;)&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;(False Negative, True Negative) = (&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span> <span class="o">+</span><span class="s1">&#39;,&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">tn</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;)</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="c1"># calculate precision manually</span>
<span class="n">rf_precision_manual</span> <span class="o">=</span> <span class="n">tp</span><span class="o">/</span><span class="p">(</span><span class="n">tp</span> <span class="o">+</span> <span class="n">fp</span><span class="p">)</span>

<span class="c1"># calculate precision with a function</span>
<span class="n">rf_precision_function</span> <span class="o">=</span> <span class="n">precision_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">rf_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">))</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Precision (manual calculation)</span><span class="se">\t\t</span><span class="s1">:&#39;</span><span class="p">,</span> <span class="n">rf_precision_manual</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Precision (precision_score function)</span><span class="se">\t</span><span class="s1">:&#39;</span><span class="p">,</span> <span class="n">rf_precision_function</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Construct a confusion matrix:
(True Positive, False Positive) = (99,147)
(False Negative, True Negative) = (56,1035)

Precision (manual calculation)		: 0.4024390243902439
Precision (precision_score function)	: 0.4024390243902439
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="recall">
<h4>Recall<a class="headerlink" href="#recall" title="Permalink to this headline">¶</a></h4>
<p>Recall measures the proportion between the number of lines that are correctly identified as defective and the number of actual defective lines.
More specifically, we compute recall using a calculation of <span class="math notranslate nohighlight">\(\frac{TP}{(TP+FN)}\)</span>, where <span class="math notranslate nohighlight">\(TP\)</span> is the number of actual defective lines that are predicted as defective and <span class="math notranslate nohighlight">\(FN\)</span> is the number of actual defective lines that are predicted as clean.
A high recall value indicates that the approach can identify more defective lines.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">recall_score</span>

<span class="c1"># calculate recall manually</span>
<span class="n">rf_recall_manual</span> <span class="o">=</span> <span class="n">tp</span><span class="o">/</span><span class="p">(</span><span class="n">tp</span> <span class="o">+</span> <span class="n">fn</span><span class="p">)</span>

<span class="c1"># calculate recall with a function</span>
<span class="n">rf_recall_function</span> <span class="o">=</span> <span class="n">recall_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">rf_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">))</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Recall (manual calculation)</span><span class="se">\t\t</span><span class="s1">:&#39;</span><span class="p">,</span> <span class="n">rf_recall_manual</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Recall (recall_score function)</span><span class="se">\t</span><span class="s1">:&#39;</span><span class="p">,</span> <span class="n">rf_recall_function</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Recall (manual calculation)		: 0.6387096774193548
Recall (recall_score function)	: 0.6387096774193548
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="false-alarm-rate-far-or-false-positive-rate-fpr">
<h4>False Alarm Rate (FAR) or False Positive Rate (FPR)<a class="headerlink" href="#false-alarm-rate-far-or-false-positive-rate-fpr" title="Permalink to this headline">¶</a></h4>
<p>FAR measures a proportion between the number of clean lines that are identified as defective and the number of actual clean lines.
More specifically, FAR can be calculated with a calculation of <span class="math notranslate nohighlight">\(\frac{FP}{(FP+TN)}\)</span>, where <span class="math notranslate nohighlight">\(FP\)</span> is the number of actual clean lines that are predicted as defective and <span class="math notranslate nohighlight">\(TN\)</span> is the number of actual clean lines that are predicted as clean.
The lower the FAR value is, the fewer the clean lines that are identified as defective.
In other words, a low FAR value indicates that developers spend less effort when inspecting defect-prone lines identified by the an approach.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># calculate FAR manually</span>
<span class="n">rf_FAR_manual</span> <span class="o">=</span> <span class="n">fp</span> <span class="o">/</span> <span class="p">(</span><span class="n">fp</span> <span class="o">+</span> <span class="n">tn</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;FAR (manual calculation)</span><span class="se">\t\t</span><span class="s1">:&#39;</span><span class="p">,</span> <span class="n">rf_FAR_manual</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>FAR (manual calculation)		: 0.12436548223350254
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="area-under-the-receiver-operator-characteristic-curve-auc">
<h4>Area Under the receiver operator characteristic Curve (AUC)<a class="headerlink" href="#area-under-the-receiver-operator-characteristic-curve-auc" title="Permalink to this headline">¶</a></h4>
<p>AUC measures the discriminatory power of predictive models and is widely suggested by recent research <span id="id3">[<a class="reference internal" href="../References.html#id166">LBMP08</a>]</span><span id="id4">[<a class="reference internal" href="../References.html#id77">GMH15</a>]</span><span id="id5">[<a class="reference internal" href="../References.html#id247">RD13</a>]</span>.
The axes of the curve of the AUC measure are the coverage of non-defective modules (true negative rate) for the x-axis and the coverage of defective modules (true positive rate) for the y-axis.
The AUC measure is a threshold-independent performance measure that evaluates the ability of models in discriminating between defective and clean instances.
The values of AUC range between 0 (worst), 0.5 (no better than random guessing), and 1 (best) <span id="id6">[<a class="reference internal" href="../References.html#id435">HM82</a>]</span>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">roc_auc_score</span> 

<span class="c1"># calculate AUC with a function</span>
<span class="n">rf_AUC_function</span> <span class="o">=</span> <span class="n">roc_auc_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">rf_model</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">X_test</span><span class="p">)[:,</span><span class="mi">1</span><span class="p">])</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;AUC (roc_auc_score function)</span><span class="se">\t\t</span><span class="s1">:&#39;</span><span class="p">,</span> <span class="n">rf_AUC_function</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>AUC (roc_auc_score function)		: 0.8589023524916761
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="matthews-correlation-coefficients-mcc">
<h4>Matthews Correlation Coefficients (MCC)<a class="headerlink" href="#matthews-correlation-coefficients-mcc" title="Permalink to this headline">¶</a></h4>
<p>MCC measures a correlation coefficients between actual and predicted outcomes using the following calculation:
\begin{equation}
\frac{TP \times TN - FP \times FN}{\sqrt{(TP+FP)(TP+FN)(TN+FP)(TN+FN)}}
\end{equation}
An MCC value ranges from -1 to +1, where an MCC value of 1 indicates a perfect prediction, and -1 indicates total disagreement between the prediction.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">matthews_corrcoef</span>

<span class="c1"># calculate MCC manually</span>
<span class="n">rf_MCC_manual</span> <span class="o">=</span> <span class="p">((</span><span class="n">tp</span> <span class="o">*</span> <span class="n">tn</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">fp</span> <span class="o">*</span> <span class="n">fn</span><span class="p">))</span> <span class="o">/</span> <span class="p">(((</span><span class="n">tp</span> <span class="o">+</span> <span class="n">fp</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">tp</span> <span class="o">+</span> <span class="n">fn</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">tn</span> <span class="o">+</span> <span class="n">fp</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">tn</span> <span class="o">+</span> <span class="n">fn</span><span class="p">))</span> <span class="o">**</span> <span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">2</span><span class="p">))</span>

<span class="c1"># calculate MCC with a function</span>
<span class="n">rf_MCC_function</span> <span class="o">=</span> <span class="n">matthews_corrcoef</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">rf_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">))</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;MCC (manual calculation)</span><span class="se">\t\t</span><span class="s1">:&#39;</span><span class="p">,</span> <span class="n">rf_MCC_manual</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;MCC (matthews_corrcoef function)</span><span class="se">\t</span><span class="s1">:&#39;</span><span class="p">,</span> <span class="n">rf_MCC_function</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>MCC (manual calculation)		: 0.4249604383453459
MCC (matthews_corrcoef function)	: 0.4249604383453459
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="effort-aware-measures">
<h3>Effort-Aware Measures<a class="headerlink" href="#effort-aware-measures" title="Permalink to this headline">¶</a></h3>
<div class="section" id="initial-false-alarm-ifa">
<h4>Initial False Alarm (IFA)<a class="headerlink" href="#initial-false-alarm-ifa" title="Permalink to this headline">¶</a></h4>
<p>IFA measures the number of clean lines on which developers spend SQA effort until the first defective line is found when lines are ranked by their defect-proneness <span id="id7">[<a class="reference internal" href="../References.html#id113">HXL17</a>]</span>.
A low IFA value indicates that few clean lines are ranked at the top, while a high IFA value indicates that developers will spend unnecessary effort on clean lines.
The intuition behinds this measure is that developers may stop inspecting if they could not get promising results (i.e., find defective lines) within the first few inspected lines <span id="id8">[<a class="reference internal" href="../References.html#id236">PO11</a>]</span>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Generate a defect-proneness ranking of testing instances</span>
<span class="n">X_test_df</span> <span class="o">=</span> <span class="n">X_test</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">X_test_df</span><span class="p">[</span><span class="s1">&#39;predicted_prob&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">rf_model</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">X_test</span><span class="p">)[:,</span> <span class="mi">1</span><span class="p">]</span>
<span class="n">X_test_df</span> <span class="o">=</span> <span class="n">X_test_df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;predicted_prob&#39;</span><span class="p">],</span> <span class="n">ascending</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>

<span class="c1"># Determine the Initial False Alarm (IFA)</span>
<span class="n">IFA</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">for</span> <span class="n">test_index</span> <span class="ow">in</span> <span class="n">X_test_df</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
    <span class="n">IFA</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">if</span> <span class="n">y_test</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">test_index</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">break</span>
        
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Initial False Alarm (IFA)</span><span class="se">\t\t</span><span class="s1">:&#39;</span><span class="p">,</span> <span class="n">IFA</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Initial False Alarm (IFA)		: 1
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="distance-to-heaven-d2h">
<h4>Distance-to-Heaven (D2H)<a class="headerlink" href="#distance-to-heaven-d2h" title="Permalink to this headline">¶</a></h4>
<p>D2H is a combination of recall and FAR proposed by Agrawal and Menzies <span id="id9">[<a class="reference internal" href="../References.html#id3">AM18</a>]</span> <span id="id10">[<a class="reference internal" href="../References.html#id6">AFC+19</a>]</span>.
The calculation of D2H is the root mean square of the recall and false alarm values (i.e., <span class="math notranslate nohighlight">\(\sqrt{\frac{(1-Recall)^2 + (0-FAR)^2}{2}}\)</span>).
A d2h value of 0 indicates that an approach achieves a perfect identification, i.e., an approach can identify all defective lines (Recall <span class="math notranslate nohighlight">\(= 1\)</span>) without any false positives (FAR <span class="math notranslate nohighlight">\(= 0\)</span>).
A high d2h value indicates that the performance of an approach is far from perfect, e.g., achieving a high recall value but also have high a FAR value and vice versa.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">recall_score</span>

<span class="c1"># calculate recall with a function</span>
<span class="n">rf_recall_function</span> <span class="o">=</span> <span class="n">recall_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">rf_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">))</span>

<span class="c1"># calculate FAR manually</span>
<span class="n">rf_FAR_manual</span> <span class="o">=</span> <span class="n">fp</span> <span class="o">/</span> <span class="p">(</span><span class="n">fp</span> <span class="o">+</span> <span class="n">tn</span><span class="p">)</span>

<span class="c1"># calculate D2H manually</span>
<span class="n">rf_D2H_numerator</span> <span class="o">=</span> <span class="p">((</span><span class="mi">1</span> <span class="o">-</span> <span class="n">rf_recall_function</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="p">((</span><span class="mi">0</span> <span class="o">-</span> <span class="n">rf_FAR_manual</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<span class="n">rf_D2H_denominator</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">rf_D2H_manual</span> <span class="o">=</span> <span class="p">(</span><span class="n">rf_D2H_numerator</span> <span class="o">/</span> <span class="n">rf_D2H_denominator</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;D2H (manual calculation)</span><span class="se">\t\t</span><span class="s1">:&#39;</span><span class="p">,</span> <span class="n">rf_D2H_manual</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>D2H (manual calculation)		: 0.27018278105904375
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="top-k-loc-precision">
<h4>Top k% LOC Precision<a class="headerlink" href="#top-k-loc-precision" title="Permalink to this headline">¶</a></h4>
<p>Top k% LOC Precision measures how many defective lines found when inspecting the top k% of lines ranked by the defect-proneness estimated by the models <span id="id11">[<a class="reference internal" href="../References.html#id113">HXL17</a>]</span>.
A high value of Top k% LOC precision indicates that the model can rank many defective lines at the top and many defective lines can be found given the fixed amount of effort (i.e., k% of LOC).
On the other hand, the low value of Top k% LOC precision indicates many clean lines are in the top k% LOC and developers need to inspect more lines to identify defects.
Similar to prior studies <span id="id12">[<a class="reference internal" href="../References.html#id200">MK10</a>]</span> <span id="id13">[<a class="reference internal" href="../References.html#id136">KMM+10</a>]</span> <span id="id14">[<a class="reference internal" href="../References.html#id248">RKBD14</a>]</span> <span id="id15">[<a class="reference internal" href="../References.html#id254">RHG+16</a>]</span>, we use 20% of LOC as a fixed cutoff for an effort in this interactive tutorial.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">precision_score</span>

<span class="c1"># Generate a defect-proneness ranking of testing instances</span>
<span class="n">X_test_df</span> <span class="o">=</span> <span class="n">X_test</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">X_test_df</span><span class="p">[</span><span class="s1">&#39;predicted_prob&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">rf_model</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">X_test</span><span class="p">)[:,</span> <span class="mi">1</span><span class="p">]</span>
<span class="n">X_test_df</span> <span class="o">=</span> <span class="n">X_test_df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;predicted_prob&#39;</span><span class="p">],</span> <span class="n">ascending</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>

<span class="c1"># calculate the value of k% LOC, where k = 20</span>
<span class="n">k_percent</span> <span class="o">=</span> <span class="mf">20.0</span>
<span class="n">total_LOC</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">X_test_df</span><span class="p">[</span><span class="s1">&#39;LOC&#39;</span><span class="p">])</span>
<span class="n">p20_LOC</span> <span class="o">=</span> <span class="n">total_LOC</span> <span class="o">*</span> <span class="n">k_percent</span> <span class="o">/</span> <span class="mi">100</span>

<span class="c1"># find Top k% LOC according to the defect-proneness ranking of testing instances</span>
<span class="n">cumsum_LOC</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">last_index</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">X_test</span><span class="p">)):</span>
    <span class="n">cumsum_LOC</span> <span class="o">+=</span> <span class="n">X_test_df</span><span class="p">[</span><span class="s1">&#39;LOC&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="n">last_index</span> <span class="o">=</span> <span class="n">i</span>
    
    <span class="k">if</span> <span class="n">cumsum_LOC</span> <span class="o">&gt;</span> <span class="n">p20_LOC</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Cumsum_LOC =&#39;</span><span class="p">,</span> <span class="n">cumsum_LOC</span><span class="p">,</span> <span class="s1">&#39;Index&#39;</span><span class="p">,</span> <span class="n">last_index</span><span class="p">)</span>
        <span class="k">break</span>
<span class="n">p20_LOC_X_test_df</span> <span class="o">=</span> <span class="n">X_test_df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="n">last_index</span><span class="p">,</span> <span class="p">:]</span>
<span class="n">p20_LOC_y_test_df</span> <span class="o">=</span> <span class="n">y_test</span><span class="p">[</span><span class="n">p20_LOC_X_test_df</span><span class="o">.</span><span class="n">index</span><span class="p">]</span>

<span class="c1"># calculate precision of Top k% LOC</span>
<span class="n">rf_p20_precision_function</span> <span class="o">=</span> <span class="n">precision_score</span><span class="p">(</span><span class="n">p20_LOC_y_test_df</span><span class="p">,</span> <span class="n">rf_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">p20_LOC_X_test_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">X_test</span><span class="o">.</span><span class="n">columns</span><span class="p">]))</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Top 20% LOC Precision (precision_score function)</span><span class="se">\t</span><span class="s1">:&#39;</span><span class="p">,</span> <span class="n">rf_p20_precision_function</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Cumsum_LOC = 3736 Index 231
Top 20% LOC Precision (precision_score function)	: 0.4025974025974026
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="top-k-loc-recall">
<h4>Top k% LOC Recall<a class="headerlink" href="#top-k-loc-recall" title="Permalink to this headline">¶</a></h4>
<p>Top k%LOC recall measures how many actual defective lines found given a fixed amount of effort, i.e., the top k% of lines ranked by their defect-proneness <span id="id16">[<a class="reference internal" href="../References.html#id113">HXL17</a>]</span>.
A high value of top k% LOC recall indicates that an approach can rank many actual defective lines at the top and many actual defective lines can be found given a fixed amount of effort.
On the other hand, a low value of top k% LOC recall indicates many clean lines are in the top k% LOC and developers need to spend more effort to identify defective lines.
Similarly, we use 20% of LOC as a fixed cutoff for an effort.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">recall_score</span>

<span class="c1"># Generate a defect-proneness ranking of testing instances</span>
<span class="n">X_test_df</span> <span class="o">=</span> <span class="n">X_test</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">X_test_df</span><span class="p">[</span><span class="s1">&#39;predicted_prob&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">rf_model</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">X_test</span><span class="p">)[:,</span> <span class="mi">1</span><span class="p">]</span>
<span class="n">X_test_df</span> <span class="o">=</span> <span class="n">X_test_df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;predicted_prob&#39;</span><span class="p">],</span> <span class="n">ascending</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>

<span class="c1"># calculate the value of k% LOC, where k = 20</span>
<span class="n">k_percent</span> <span class="o">=</span> <span class="mf">20.0</span>
<span class="n">total_LOC</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">X_test_df</span><span class="p">[</span><span class="s1">&#39;LOC&#39;</span><span class="p">])</span>
<span class="n">p20_LOC</span> <span class="o">=</span> <span class="n">total_LOC</span> <span class="o">*</span> <span class="n">k_percent</span> <span class="o">/</span> <span class="mi">100</span>

<span class="c1"># find Top k% LOC according to the defect-proneness ranking of testing instances</span>
<span class="n">cumsum_LOC</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">last_index</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">X_test</span><span class="p">)):</span>
    <span class="n">cumsum_LOC</span> <span class="o">+=</span> <span class="n">X_test_df</span><span class="p">[</span><span class="s1">&#39;LOC&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="n">last_index</span> <span class="o">=</span> <span class="n">i</span>
    
    <span class="k">if</span> <span class="n">cumsum_LOC</span> <span class="o">&gt;</span> <span class="n">p20_LOC</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Cumsum_LOC =&#39;</span><span class="p">,</span> <span class="n">cumsum_LOC</span><span class="p">,</span> <span class="s1">&#39;Index&#39;</span><span class="p">,</span> <span class="n">last_index</span><span class="p">)</span>
        <span class="k">break</span>
<span class="n">p20_LOC_X_test_df</span> <span class="o">=</span> <span class="n">X_test_df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="n">last_index</span><span class="p">,</span> <span class="p">:]</span>
<span class="n">p20_LOC_y_test_df</span> <span class="o">=</span> <span class="n">y_test</span><span class="p">[</span><span class="n">p20_LOC_X_test_df</span><span class="o">.</span><span class="n">index</span><span class="p">]</span>

<span class="c1"># calculate recall of Top k% LOC</span>
<span class="n">rf_p20_recall_function</span> <span class="o">=</span> <span class="n">recall_score</span><span class="p">(</span><span class="n">p20_LOC_y_test_df</span><span class="p">,</span> <span class="n">rf_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">p20_LOC_X_test_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">X_test</span><span class="o">.</span><span class="n">columns</span><span class="p">]))</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Top 20% LOC Recall (recall_score function)</span><span class="se">\t</span><span class="s1">:&#39;</span><span class="p">,</span> <span class="n">rf_p20_recall_function</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Cumsum_LOC = 3736 Index 231
Top 20% LOC Recall (recall_score function)	: 1.0
</pre></div>
</div>
</div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Parts of this chapter have been published by Supatsara Wattanakriengkrai, Patanamon Thongtanunam, Chakkrit Tantithamthavorn, Hideaki Hata, Kenichi Matsumoto: Predicting Defective Lines Using a Model-Agnostic Technique. CoRR abs/2009.03612 (2020).</p>
</div>
</div>
</div>
</div>
<div class="section" id="suggested-readings">
<h2>Suggested Readings<a class="headerlink" href="#suggested-readings" title="Permalink to this headline">¶</a></h2>
<p>[1] Amritanshu Agrawal, Tim Menzies: Is “better data” better than “better data miners”?: on the benefits of tuning SMOTE for defect prediction. ICSE 2018: 1050-1061.</p>
<p>[2] Amritanshu Agrawal, Wei Fu, Di Chen, Xipeng Shen, Tim Menzies: How to “DODGE” Complex Software Analytics? CoRR abs/1902.01838 (2019).</p>
<p>[3] Chris Parnin, Alessandro Orso: Are automated debugging techniques actually helping programmers? ISSTA 2011: 199-209.</p>
<p>[4] Qiao Huang, Xin Xia, David Lo: Supervised vs Unsupervised Models: A Holistic Look at Effort-Aware Just-in-Time Defect Prediction. ICSME 2017: 159-170.</p>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "xaitools"
        },
        kernelOptions: {
            kernelName: "xaitools",
            path: "./defect-prediction"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'xaitools'</script>

              </div>
              
        
        <div class='prev-next-bottom'>
            
    <a class='left-prev' id="prev-link" href="model-construction.html" title="previous page">(Step 3) Model Construction</a>
    <a class='right-next' id="next-link" href="model-ranking.html" title="next page">(Step 5) Model Ranking</a>

        </div>
        
        </div>
    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By Chakkrit Tantithamthavorn and Jirayus Jiarpakdee<br/>
        
            &copy; Copyright 2021.<br/>
          <div class="extra_footer">
            <script>mermaid.init();</script> <div class="row_footer"> This project has received funding from the <a href="https://www.arc.gov.au/">Australian Research Council</a>'s Discovery Early Career Researcher Award (ARC DECRA) funding scheme (DE200100941). This book reflects the views of the authors and neither Australian Research Council nor Monash University are liable for any use that may be made of the information contained herein. The content of this project is licensed under the Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International License. The source code that is part of the content, as well as the source code used to format and display that content is licensed under the MIT License. </div>
          </div>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>
  
  <script src="../_static/js/index.1c5a1a01449ed65a7b51.js"></script>

  
<script async="" src="https://www.google-analytics.com/analytics.js"></script>
<script>
                        window.ga = window.ga || function () {
                            (ga.q = ga.q || []).push(arguments) };
                        ga.l = +new Date;
                        ga('create', 'UA-54962993-1', 'auto');
                        ga('set', 'anonymizeIp', true);
                        ga('send', 'pageview');
                    </script>

  </body>
</html>